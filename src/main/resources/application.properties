# =============================================================================
# Database Configuration (SQLite for Durable Execution)
# =============================================================================
quarkus.datasource.db-kind=other
quarkus.datasource.jdbc.driver=org.sqlite.JDBC

# SQLite Connection URL:
# - _busy_timeout: wait up to 120 seconds for lock release
# - _journal_mode=WAL: Write-Ahead Logging for better concurrency
# - _synchronous=NORMAL: Good balance of safety and speed
# - _cache_size: Larger cache for better performance
# - _txlock=immediate: Acquire write lock immediately to avoid deadlocks
quarkus.datasource.jdbc.url=jdbc:sqlite:camel.db?_busy_timeout=120000&_journal_mode=WAL&_synchronous=NORMAL&_cache_size=10000&_txlock=immediate

# SQLite Connection Pool Configuration
# SQLite WAL mode allows ONE writer + multiple readers concurrently
# Pool size > 1 needed to avoid blocking when scheduler reads while Camel writes
quarkus.datasource.jdbc.max-size=5
quarkus.datasource.jdbc.min-size=2
quarkus.datasource.jdbc.initial-size=2

# Longer acquisition timeout for write contention
quarkus.datasource.jdbc.acquisition-timeout=180
# Transaction isolation for SQLite
quarkus.datasource.jdbc.transaction-isolation-level=SERIALIZABLE

# Keep JTA enabled for @Transactional support
# But use LOCAL_TRANSACTION mode instead of XA
quarkus.datasource.jdbc.transactions=enabled

# Hibernate configuration
quarkus.hibernate-orm.database.generation=update
quarkus.hibernate-orm.sql-load-script=import.sql
quarkus.hibernate-orm.log.sql=false
# Disable batching for SQLite (single writer)
quarkus.hibernate-orm.jdbc.statement-batch-size=1
# Use SQLite dialect
quarkus.hibernate-orm.dialect=org.hibernate.community.dialect.SQLiteDialect

# =============================================================================
# Transaction Manager Configuration
# =============================================================================
# Increase default transaction timeout to 10 minutes
quarkus.transaction-manager.default-transaction-timeout=PT10M
# Disable XA recovery for SQLite
quarkus.transaction-manager.enable-recovery=false

# =============================================================================
# HTTP Configuration
# =============================================================================
quarkus.http.port=8080
quarkus.http.cors=true
quarkus.http.cors.origins=/.*/
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS
quarkus.http.cors.headers=accept,authorization,content-type,x-requested-with
quarkus.http.cors.exposed-headers=*
quarkus.http.cors.access-control-allow-credentials=true

# =============================================================================
# Logging Configuration
# =============================================================================
quarkus.log.handler.console."CONSOLE".enable=true
quarkus.log.handler.console."CONSOLE".format=%d{HH:mm:ss} %-5p [%c{2.}] (%t) %s%e%n

# Enable detailed logs for development
quarkus.log.level=INFO
quarkus.log.category."com.outcastgeek".level=DEBUG

# Enable Camel logs
quarkus.log.category."org.apache.camel".level=INFO
quarkus.log.category."org.apache.camel.engine.AbstractCamelContext".level=INFO

# =============================================================================
# Native Build Configuration
# =============================================================================
quarkus.native.container-build=true
quarkus.native.builder-image=quay.io/quarkus/ubi-quarkus-mandrel-builder-image:jdk-25
quarkus.package.jar.enabled=false
quarkus.native.enabled=true

# =============================================================================
# Scheduler Configuration (for crash recovery)
# =============================================================================
quarkus.scheduler.enabled=true

# =============================================================================
# Virtual Threads Configuration (Java 21+)
# =============================================================================
# Enable virtual threads for better concurrency with blocking I/O
quarkus.virtual-threads.name-prefix=quarkus-vt-
# Run scheduled tasks on virtual threads to avoid blocking worker threads
quarkus.scheduler.use-virtual-threads=true

# =============================================================================
# Langchain4j Configuration
# =============================================================================
quarkus.langchain4j.log-requests=true
quarkus.langchain4j.log-responses=true

# Google Gemini API Key
gemini.api.key=${GEMINI_API_KEY:your-api-key-here}
gemini.model.name=${GEMINI_MODEL_NAME:gemini-2.5-flash-lite}
gemini.model.temperature=${GEMINI_MODEL_TEMPERATURE:0.7}
